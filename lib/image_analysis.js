var ctx,img,imgInstance,canvasInstance,popEnd,popEnd_Draw,baseCanvas,clicksBlack=0,clicksBlue=0,clicksRed=0,clicksGreen=0,clicksYellow=0,clicksGray=0,clicksOrange=0,clicksPurple=0,startx=new Array,endx=new Array,starty=new Array,endy=new Array,canvases=new Array,arg=new Array,arg_Draw=new Array,tempArrayNew=new Array,tempArrayNew_Draw=new Array,tempArray_Angle=new Array,tempArrayCount=new Array,new_arr_count=new Array;function createCanvasHistory(){var e="canvasHistory"+canvases.length,t=$("<canvas></canvas>");return t.attr("id",e),t.attr("class","canvas"),t.css("z-index",canvases.length+2),canvases.push(t),t.insertAfter($("#canvases")),canvas=new fabric.Canvas(e,{hoverCursor:"pointer",selection:!1,width:800,height:800}),canvas}function createCanvasHistoryDraw(){var e="canvasHistory"+canvases.length,t=$("<canvas></canvas>");return t.attr("id",e),t.attr("class","canvas"),t.css("z-index",canvases.length+2),canvases.push(t),t.insertAfter($("#canvases")),canvas=new fabric.Canvas(e,{hoverCursor:"pointer",selection:!1,width:800,height:800,isDrawingMode:!0}),canvas.freeDrawingBrush.width=$("#selWidth").val(),canvas.freeDrawingBrush.color=$("#selColor").val(),canvas}function letsGrey(){imgInstance.filters.push(new fabric.Image.filters.Grayscale),imgInstance.applyFilters(baseCanvas.renderAll.bind(baseCanvas)),$("#grayer").attr("disabled",!0)}function letsInvert(){imgInstance.filters.push(new fabric.Image.filters.Invert),imgInstance.applyFilters(baseCanvas.renderAll.bind(baseCanvas)),$("#inverter").attr("disabled",!0)}function letsRemoveWhite(){imgInstance.filters.push(new fabric.Image.filters.RemoveWhite),imgInstance.applyFilters(baseCanvas.renderAll.bind(baseCanvas)),$("#remover").attr("disabled",!0)}function letsBright(){var e=document.getElementById("brightness-value").value,t=parseInt(e);imgInstance.filters.push(new fabric.Image.filters.Brightness({brightness:t})),imgInstance.applyFilters(baseCanvas.renderAll.bind(baseCanvas))}function letsSharpen(){imgInstance.filters.push(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]})),imgInstance.applyFilters(baseCanvas.renderAll.bind(baseCanvas)),$("#sharper").attr("disabled",!0)}function letsBegin(){$("#file_input").change(function(e){$("#option1").attr("disabled",!1),$("#option2").attr("disabled",!1),$("#option3").attr("disabled",!1),$("#option4").attr("disabled",!1),$("#grayer").attr("disabled",!1),$("#remover").attr("disabled",!1),$("#inverter").attr("disabled",!1),$("#sharper").attr("disabled",!1),$("#brighter").attr("disabled",!1),$("#brightness-value").attr("disabled",!1);var t=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]);(img=new Image).src=t,img.onload=function(){ctx=document.getElementById("myCanvas").getContext("2d"),imgInstance=new fabric.Image(img,{left:0,width:800,height:800,top:0,angle:0,opacity:1}),baseCanvas.add(imgInstance),$("#file_input").attr("disabled",!0)}})}function letsMeasure(){$("#mean_option").attr("disabled",!1),$("#grayer").attr("disabled",!0),$("#remover").attr("disabled",!0),$("#inverter").attr("disabled",!0),$("#sharper").attr("disabled",!0),$("#brighter").attr("disabled",!0),$("#brightness-value").attr("disabled",!0);var e,t,a,r=document.getElementById("obj_mag").value,n=document.getElementById("pixel_size").value,i=document.getElementById("bin_size").value,s=document.getElementById("c_mount").value,l=document.getElementById("lens_mag").value,o=(document.getElementById("real_width").value,n*i/(r*s*l)*(document.getElementById("real_height").value/800)),c=(new Array,new Array),d=new Array,g=new Array,u=new Array;trigger="1",canvas=createCanvasHistory(),fabric.Object.prototype.transparentCorners=!1,canvas.on("mouse:down",function(a){if("1"==trigger){t=!0;var r=canvas.getPointer(a.e),n=[r.x,r.y,r.x,r.y];c[0]=r.x,g[0]=r.y,e=new fabric.Line(n,{strokeWidth:$("#selWidth").val(),stroke:$("#selColor").val(),originX:"center",originY:"center"}),canvas.add(e)}else canvas.forEachObject(function(e){e.setCoords()})}),canvas.on("mouse:move",function(r){if(canvas.remove(a),canvas.renderAll(),t){var n=canvas.getPointer(r.e);if(e.set({x2:n.x,y2:n.y}),d[0]=n.x,u[0]=n.y,"1"==trigger){var i=v.lineLength(c[0],g[0],d[0],u[0]).toFixed(2);a=new fabric.Text("Length "+i,{left:d[0],top:u[0],stroke:$("#selColor").val(),fontSize:18}),tempArrayNew.push(i),canvas.add(a)}canvas.renderAll()}}),canvas.on("mouse:up",function(e){canvas.getPointer(e.e);t=!1,popEnd=tempArrayNew.slice(-1).pop(),arg.push(popEnd)}),canvas.on("mouse:over",function(e){e.target.setStroke("blue"),canvas.renderAll()}),canvas.on("mouse:out",function(e){e.target.setStroke("red"),canvas.renderAll()});var v={lineLength:function(e,t,a,r){return o*Math.sqrt(Math.pow(1*a-1*e,2)+Math.pow(1*r-1*t,2))}}}function letsDraw(){$("#mean_Draw_option").attr("disabled",!1),$("#grayer").attr("disabled",!0),$("#remover").attr("disabled",!0),$("#inverter").attr("disabled",!0),$("#sharper").attr("disabled",!0),$("#brighter").attr("disabled",!0),$("#brightness-value").attr("disabled",!0),canvas=createCanvasHistoryDraw(),fabric.Object.prototype.transparentCorners=!1;var e,t,a,r=document.getElementById("obj_mag").value,n=document.getElementById("pixel_size").value,i=document.getElementById("bin_size").value,s=document.getElementById("c_mount").value,l=document.getElementById("lens_mag").value,o=(document.getElementById("real_width").value,n*i/(r*s*l)*(document.getElementById("real_height").value/800)),c=(new Array,new Array),d=new Array,g=new Array,u=new Array;trigger="1";var v=[];canvas.on("mouse:down",function(a){if("1"==trigger){t=!0;var r=canvas.getPointer(a.e);v=[{x:r.x,y:r.y}],c[0]=r.x,g[0]=r.y,e=new fabric.Polyline(v,{strokeWidth:$("#selWidth").val(),stroke:$("#selColor").val(),originX:"center",originY:"center"}),canvas.add(e)}else canvas.forEachObject(function(e){e.setCoords()})}),canvas.on("mouse:move",function(r){if(canvas.remove(a),canvas.renderAll(),t){var n=canvas.getPointer(r.e);if(e.set({x2:n.x,y2:n.y}),v.push({x:n.x,y:n.y}),d[0]=n.x,u[0]=n.y,"1"==trigger){var i=p.lineLength(v).toFixed(2);a=new fabric.Text("Length "+i,{left:d[0],top:u[0],stroke:$("#selColor").val(),fontSize:18}),tempArrayNew_Draw.push(i),canvas.add(a)}canvas.renderAll()}}),canvas.on("mouse:up",function(e){canvas.getPointer(e.e);t=!1,popEnd_Draw=tempArrayNew_Draw.slice(-1).pop(),arg_Draw.push(popEnd_Draw)});var p={lineLength:function(e){for(var t=0,a=0;a<e.length-1;a++){var r=e[a],n=e[a+1];t+=o*Math.sqrt(Math.pow(1*n.x-1*r.x,2)+Math.pow(1*n.y-1*r.y,2))}return t}}}function letsCount(){$("#mean_count_option").attr("disabled",!1),$("#chemoTaxis_option").attr("disabled",!1),$("#avoidTaxis_option").attr("disabled",!1),$("#thermoTaxis_option").attr("disabled",!1),$("#saltTaxis_option").attr("disabled",!1),$("#aversionTaxis_option").attr("disabled",!1),$("#quadTaxis_option").attr("disabled",!1),$("#grayer").attr("disabled",!0),$("#remover").attr("disabled",!0),$("#inverter").attr("disabled",!0),$("#sharper").attr("disabled",!0),$("#brighter").attr("disabled",!0),$("#brightness-value").attr("disabled",!0),canvas=createCanvasHistory(),canvas.on("mouse:down",function(e){DrawCircle(canvas,e.e.offsetX-12,e.e.offsetY-12,!0),counterFunc()})}function DrawCircle(e,t,a,r){fabric.Object.prototype.transparentCorners=!1;var n=$("#selColor").val(),i=$("#selWidth").val(),s=new fabric.Circle({radius:i,fill:n,left:t,top:a});e.add(s)}function letsAngle(){$("#mean_Angle_option").attr("disabled",!1),$("#grayer").attr("disabled",!0),$("#remover").attr("disabled",!0),$("#inverter").attr("disabled",!0),$("#sharper").attr("disabled",!0),$("#brighter").attr("disabled",!0),$("#brightness-value").attr("disabled",!0),canvas=createCanvasHistory(),fabric.Object.prototype.transparentCorners=!1;var e=new fabric.Text("0",{fontSize:18,stroke:$("#selColor").val(),fontFamily:"Arial",originX:"center",originY:"bottom"});function t(e,t,a,r,n,i){var s=new fabric.Triangle({left:e,top:t,strokeWidth:2,fill:"#fff",stroke:"#666",angle:-180,width:10,height:10});return s.hasControls=s.hasBorders=!1,s.line1=a,s.line2=r,s.line3=n,s.line4=i,s}function a(e){return new fabric.Line(e,{fill:"red",stroke:$("#selColor").val(),strokeWidth:2,selectable:!1})}fabric.Object.prototype.originX=fabric.Object.prototype.originY="center";var r=a([250,175,250,250]),n=a([250,250,300,350]),i=a([250,250,200,350]);canvas.add(n,i),canvas.add(function(t,a,r,n,i,s){var l=new fabric.Circle({strokeWidth:1,fill:"",stroke:"#666",radius:18,width:10,height:10,originX:"center",originY:"center"}),o=new fabric.Group([e,l],{left:t,top:a});return o.hasControls=!1,o.line1=r,o.line2=n,o.line3=i,o.line4=s,o}(r.get("x2"),r.get("y2"),r,n,i),t(n.get("x2"),n.get("y2"),n),t(i.get("x2"),i.get("y2"),i)),canvas.on("object:moving",function(t){var a=t.target;a.line1&&a.line1.set({x2:a.left,y2:a.top}),a.line2&&a.line2.set({x1:a.left,y1:a.top}),a.line3&&a.line3.set({x1:a.left,y1:a.top}),a.line4&&a.line4.set({x1:a.left,y1:a.top}),canvas.renderAll(),y11=n.get("y1"),y12=n.get("y2"),y21=i.get("y1"),y22=i.get("y2"),x11=n.get("x1"),x12=n.get("x2"),x21=i.get("x1"),x22=i.get("x2"),angle1=Math.atan2(y11-y12,x11-x12),angle2=Math.atan2(y21-y22,x21-x22),angle=angle1-angle2,angle=180*angle/Math.PI,angle<0&&(angle=-angle),360-angle<angle&&(angle=360-angle),e.setText(angle.toFixed(0))})}function counterFunc(){var e=$("#selColor").val();"blue"==e?(clicksBlue+=1,document.getElementById("clicksBlue").innerHTML="Count: "+clicksBlue+"  "):"red"==e?(clicksRed+=1,document.getElementById("clicksRed").innerHTML="Count: "+clicksRed+"  "):"green"==e?(clicksGreen+=1,document.getElementById("clicksGreen").innerHTML="Count: "+clicksGreen+"  "):"yellow"==e?(clicksYellow+=1,document.getElementById("clicksYellow").innerHTML="Count: "+clicksYellow+"  "):"black"==e?(clicksBlack+=1,document.getElementById("clicksBlack").innerHTML="Count: "+clicksBlack+"  "):"gray"==e?(clicksGray+=1,document.getElementById("clicksGray").innerHTML="Count: "+clicksGray+"  "):"orange"==e?(clicksOrange+=1,document.getElementById("clicksOrange").innerHTML="Count: "+clicksOrange+"  "):"purple"==e&&(clicksPurple+=1,document.getElementById("clicksPurple").innerHTML="Count: "+clicksPurple+"  ")}function mean_count(){var e;tempArrayCount.push(clicksBlue),tempArrayCount.push(clicksRed),tempArrayCount.push(clicksGreen),tempArrayCount.push(clicksYellow),tempArrayCount.push(clicksBlack),tempArrayCount.push(clicksGray),tempArrayCount.push(clicksOrange),tempArrayCount.push(clicksOrange),tempArrayCount.push(clicksPurple);for(var t=0;t<tempArrayCount.length;t++)0!==(e=tempArrayCount[t])&&new_arr_count.push(e);for(var a=0,r=0;r<new_arr_count.length;r++)a+=parseInt(new_arr_count[r]);var n=(a/new_arr_count.length).toFixed(2),i=parseInt(median(new_arr_count)),s=variance(new_arr_count).toFixed(2),l=Math.sqrt(variance(new_arr_count)),o=Math.sqrt(variance(new_arr_count)/(new_arr_count.length-1));alert("Average: "+n+" Median: "+i.toFixed(2)+" Variance: "+s+" Standard Deviation: "+l.toFixed(2)+" Standard Error: "+o.toFixed(2))}function mean(){if(arg.length>0){for(var e=0,t=0;t<arg.length;t++)e+=parseInt(arg[t]);var a=(e/arg.length).toFixed(2),r=parseInt(median(arg)),n=variance(arg).toFixed(2),i=Math.sqrt(variance(arg)),s=Math.sqrt(variance(arg)/(arg.length-1));alert("Average: "+a+" Median: "+r.toFixed(2)+" Variance: "+n+" Standard Deviation: "+i.toFixed(2)+" Standard Error: "+s.toFixed(2))}else alert("no measurements")}function mean_Draw(){if(arg_Draw.length>0){for(var e=0,t=0;t<arg_Draw.length;t++)e+=parseInt(arg_Draw[t]);var a=(e/arg_Draw.length).toFixed(2),r=parseInt(median(arg_Draw)),n=variance(arg_Draw).toFixed(2),i=Math.sqrt(variance(arg_Draw)),s=Math.sqrt(variance(arg_Draw)/(arg_Draw.length-1));alert("Average: "+a+" Median: "+r.toFixed(2)+" Variance: "+n+" Standard Deviation: "+i.toFixed(2)+" Standard Error: "+s.toFixed(2))}else alert("no measurements")}function median(e){e.sort(function(e,t){return e-t});return e.length%2==1?e[(e.length+1)/2-1]:(1*e[e.length/2-1]+1*e[e.length/2])/2}function variance(e){for(var t=0,a=0,r=0;r<e.length;r++)if(""==e[r]);else{if(isNaN(e[r]))return alert(e[r]+" is not number, Variance Calculation failed!"),0;t+=1,a+=parseFloat(e[r])}var n=0;if(t>1){var i=a/t;for(r=0;r<e.length;r++)""==e[r]||(n+=(e[r]-i)*(e[r]-i));return n/t}return 0}function chemoIndex(){var e,t,a=0;e=prompt("enter values for odor,control,and middle:","e.g. 110,20,30").split(",");for(var r=0;r<e.length;r++)a+=parseInt(e[r]);t=(e[0]-e[1])/a,3==e.length?alert("Chemotaxis Index: "+t.toFixed(6)):alert("incorrect data entry")}function aversionIndex(){var e,t,a=0;e=prompt("enter values for chemical and control:","e.g. 102,23").split(",");for(var r=0;r<e.length;r++)a+=parseInt(e[r]);t=e[0]/a,2==e.length?alert("Aversion Index (soluble): "+t.toFixed(6)):alert("incorrect data entry")}function quadIndex(){var e,t;e=prompt("enter values for compound in QA, control in QB, compound in QA', and control in QB':","e.g. 20,86,32,94").split(",");for(var a=0;a<e.length;a++)parseInt(e[a]);t=(e[0]-e[1])/(e[2]-e[3]),4==e.length?alert("Quadrant Chemotaxis Index: "+t.toFixed(6)):alert("incorrect data entry")}function saltIndex(){var e,t,a=0;e=prompt("enter values for soluble compound and control:","e.g. 112,14").split(",");for(var r=0;r<e.length;r++)a+=parseInt(e[r]);t=(e[0]-e[1])/a,2==e.length?alert("Chemotaxis Index (soluble): "+t.toFixed(6)):alert("incorrect data entry")}function avoidIndex(){var e,t,a=0;e=prompt("enter values for six (A-F) panels starting with odor (A):","e.g. 102,80,30,12,2,0").split(",");for(var r=0;r<e.length;r++)a+=parseInt(e[r]);t=(parseInt(e[0])+parseInt(e[1])-(parseInt(e[4])+parseInt(e[5])))/a,6==e.length?alert("Avoidance Index: "+t.toFixed(6)):alert("incorrect data entry")}function thermoIndex(){var e,t,a=0;e=prompt("enter values for eight panels starting with lowest temperature","e.g. 120,23,31,22,20,12,11,2").split(",");for(var r=0;r<e.length;r++)a+=parseInt(e[r]);var n=-4*parseInt(e[0]),i=-3*parseInt(e[1]),s=-2*parseInt(e[2]),l=-1*parseInt(e[3]),o=1*parseInt(e[4]),c=2*parseInt(e[5]),d=3*parseInt(e[6]),g=4*parseInt(e[7]);t=(parseInt(n)+parseInt(i)+parseInt(s)+parseInt(l)+parseInt(o)+parseInt(c)+parseInt(d)+parseInt(g))/a,8==e.length?alert("Thermotaxis Index: "+t.toFixed(6)):alert("incorrect data entry")}function t_test(){var e=document.getElementById("t_test_option1").value,t=document.getElementById("t_test_option2").value,a=document.getElementById("degF").value;e=e.replace(" ",""),t=t.replace(" ","");var r=e.split(","),n=t.split(",");if(r.length!==n.length)alert("unequal arrays");else{for(var i=0,s=0,l=0,o=0,c=0;c<r.length;c++)r[c]=parseFloat(r[c]),l+=r[c];for(c=0;c<n.length;c++)n[c]=parseFloat(n[c]),o+=n[c];var d=l/r.length,g=o/n.length;for(c=0;c<r.length;c++)i+=Math.pow(r[c]-d,2);for(c=0;c<n.length;c++)s+=Math.pow(n[c]-g,2);var u=i/(r.length-1),v=s/(n.length-1);sd11=Math.sqrt(u),sd12=Math.sqrt(v);Math.sqrt(((r.length-1)*u+(n.length-1*v))/(r.length+n.length-2)*(r.length+n.length)/(r.length*n.length));var p=Math.round(1e4*d)/1e4,h=Math.round(1e4*g)/1e4,m=Math.round(1e4*sd11)/1e4,y=Math.round(1e4*sd12)/1e4,f=Math.round((d-g)/Math.sqrt(u/r.length+v/n.length)*1e4)/1e4,b=StudentT(f,a);alert("Mean of Array1: "+p+" Mean of Array2: "+h+" Standard Deviation of Array1: "+m+" Standard Deviation of Array2: "+y+" T Test value: "+f+" P value: "+b.toFixed(3))}}function StudentT(e,t){var a=Math.PI,r=a/2,n=(e=Math.abs(e))/Math.sqrt(t),i=Math.atan(n),s=Math.sin(i),l=Math.cos(i);if(1==t)return 1-i/r;s=Math.sin(i),l=Math.cos(i);return t%2==1?1-(i+s*l*Stater(l*l,2,t-3,-1))/r:1-s*Stater(l*l,1,t-3,-1)}function Stater(e,t,a,r){for(var n=1,i=n,s=t;s<=a;)i+=n=n*e*s/(s-r),s+=2;return i}function clearArea(){canvas.clear(),document.getElementById("clicksBlue").innerHTML="",document.getElementById("clicksRed").innerHTML="",document.getElementById("clicksGreen").innerHTML="",document.getElementById("clicksYellow").innerHTML="",document.getElementById("clicksBlack").innerHTML="",document.getElementById("clicksGray").innerHTML="",document.getElementById("clicksOrange").innerHTML="",document.getElementById("clicksPurple").innerHTML="",clicksBlack=0,clicksBlue=0,clicksRed=0,clicksGreen=0,clicksYellow=0,clicksGray=0,clicksOrange=0,clicksPurple=0,arg=[],arg_Draw=[],tempArrayCount=[],new_arr_count=[],letsBegin()}$(function(){baseCanvas=new fabric.Canvas("myCanvas",{hoverCursor:"pointer",selection:!1,width:800,height:800})});